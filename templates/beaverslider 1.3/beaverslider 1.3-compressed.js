function BeaverSlider(d){var b=this;this.error=function(e){throw new Error(e);return false};this.settings=d;if(!this.settings){return this.error("Error: no settings parameter is passed")}if(!this.settings.structure){return this.error("Error: no structure parameter is passed")}if(!this.settings.structure.container){return this.error("Error: no container parameter is passed")}if(!this.settings.structure.container.id&&!this.settings.structure.container.selector){return this.error("Error: no id/selector parameter is passed")}if(!this.settings.structure.container.height){return this.error("Error: no height parameter is passed")}if(!this.settings.structure.container.width){return this.error("Error: no width parameter is passed")}if(!this.settings.content){return this.error("Error: no content parameter is passed")}if(!this.settings.content.images){return this.error("Error: no images parameter is passed")}if(!this.settings.animation){return this.error("Error: no animation parameter is passed")}if(!this.settings.animation.effects){return this.error("Error: no effects parameter is passed")}if(!this.settings.animation.interval){return this.error("Error: no interval parameter is passed")}for(i=0;i<d.content.images.length;i++){var a=new Image();a.onload=function(){b.imagesLoaded++};a.src=d.content.images[i]}var c=jQuery("#"+this.settings.structure.container.id);if(!c.size()){c=jQuery(this.settings.structure.container.selector)}c.css({width:this.settings.structure.container.width});this.container=jQuery("<div>").appendTo(c);this.areaMain=null;this.areaStatus=null;this.areaWidgets=null;this.areaMessage=null;this.areaPlayer=null;this.imagesLoaded=0;this.currentImage=0;this.currentMessage=0;this.stopped=false;this.animationNow=false;this.playerFadeNow=false;this.cells=null;this.currentEffect=null;this.run=null;this.messagesAnimationCounter=null;this.initialize=function(){this.constructAreaMain();this.constructAreaStatus();this.constructMessage();this.constructPlayer();this.initEffects();this.startSliding(true)};this.initEffects=function(){this.effects=[{id:0,group:"fade",name:"fadeOut",duration:1000,size:null,steps:null,run:this.fadeOut},{id:1,group:"slide",name:"slideLeft",duration:1000,size:null,steps:null,run:this.slideLeft},{id:2,group:"slide",name:"slideRight",duration:1000,size:null,steps:null,run:this.slideRight},{id:3,group:"slide",name:"slideUp",duration:1000,size:null,steps:null,run:this.slideUp},{id:4,group:"slide",name:"slideDown",duration:1000,size:null,steps:null,run:this.slideDown},{id:5,group:"chessBoard",name:"chessBoardLeftDown",duration:1000,size:10,steps:10,run:this.chessBoardLeftDown},{id:6,group:"chessBoard",name:"chessBoardLeftUp",duration:1000,size:10,steps:10,run:this.chessBoardLeftUp},{id:7,group:"chessBoard",name:"chessBoardRightDown",duration:1000,size:10,steps:10,run:this.chessBoardRightDown},{id:8,group:"chessBoard",name:"chessBoardRightUp",duration:1000,size:10,steps:10,run:this.chessBoardRightUp},{id:9,group:"chessBoard",name:"chessBoardRandom",duration:1000,size:10,steps:10,run:this.chessBoardRandom},{id:10,group:"jalousie",name:"jalousieLeft",duration:1000,size:10,steps:10,run:this.jalousieLeft},{id:11,group:"jalousie",name:"jalousieUp",duration:1000,size:10,steps:10,run:this.jalousieUp},{id:12,group:"jalousie",name:"jalousieRight",duration:1000,size:10,steps:10,run:this.jalousieRight},{id:13,group:"jalousie",name:"jalousieDown",duration:1000,size:10,steps:10,run:this.jalousieDown},{id:14,group:"jalousie",name:"jalousieRandomHorizontal",duration:1000,size:10,steps:10,run:this.jalousieRandomHorizontal},{id:15,group:"jalousie",name:"jalousieRandomVertical",duration:1000,size:10,steps:10,run:this.jalousieRandomVertical},{id:16,group:"pancake",name:"pancakeIn",duration:1000,size:10,steps:10,run:this.pancakeIn},{id:17,group:"pancake",name:"pancakeOut",duration:1000,size:10,steps:10,run:this.pancakeOut},{id:18,group:"pancake",name:"pancakeRandom",duration:1000,size:10,steps:10,run:this.pancakeRandom},{id:19,group:"spiral",name:"spiralIn",duration:1000,size:10,steps:10,run:this.spiralIn},{id:20,group:"spiral",name:"spiralOut",duration:1000,size:10,steps:10,run:this.spiralOut},{id:21,group:"prison",name:"prisonVertical",duration:1000,size:10,steps:null,run:this.prisonVertical},{id:22,group:"prison",name:"prisonHorizontal",duration:1000,size:10,steps:null,run:this.prisonHorizontal},{id:23,group:"zoom",name:"zoomLeftTop",duration:1000,size:10,steps:null,run:this.zoomLeftTop},{id:24,group:"zoom",name:"zoomLeftBottom",duration:1000,size:10,steps:null,run:this.zoomLeftBottom},{id:25,group:"zoom",name:"zoomRightTop",duration:1000,size:10,steps:null,run:this.zoomRightTop},{id:26,group:"zoom",name:"zoomRightBottom",duration:1000,size:10,steps:null,run:this.zoomRightBottom},{id:27,group:"zoom",name:"zoomCenter",duration:1000,size:10,steps:null,run:this.zoomCenter},{id:28,group:"zoom",name:"zoomRandom",duration:1000,size:10,steps:null,run:this.zoomRandom}];this.userEffects=new Array();if(this.settings.animation.effects=="random"){this.userEffects=this.effects}else{var l=(typeof this.settings.animation.effects=="string")?this.settings.animation.effects.split(","):this.settings.animation.effects;for(i=0;i<l.length;i++){var f,h,g,e;if(typeof l[i]=="string"){l[i]=l[i].split(":");f=jQuery.trim(l[i][0]);h=jQuery.trim(l[i][1]);g=jQuery.trim(l[i][2]);e=jQuery.trim(l[i][3])}else{f=jQuery.trim(l[i].name);h=jQuery.trim(l[i].duration);g=jQuery.trim(l[i].size);e=jQuery.trim(l[i].steps)}for(j=0;j<this.effects.length;j++){if(this.effects[j].group.toLowerCase()==f.toLowerCase()||this.effects[j].name.toLowerCase()==f.toLowerCase()){this.userEffects.push({id:this.effects[j].id,group:this.effects[j].group,name:this.effects[j].name,duration:(h)?h:this.effects[j].duration,size:(g)?g:this.effects[j].size,steps:(e)?e:this.effects[j].steps,run:this.effects[j].run})}}}}};this.constructAreaMain=function(){this.areaMain=jQuery("<div>").css({"white-space":"nowrap",overflow:"hidden",height:this.settings.structure.container.height}).append(jQuery("<img>").attr("src",this.settings.content.images[this.currentImage]).css({display:"inline",width:this.settings.structure.container.width+"px",height:this.settings.structure.container.height+"px",margin:0,padding:0,border:"none"}));this.areaWidgets=jQuery("<div>").css({width:this.settings.structure.container.width,height:this.settings.structure.container.height,position:"absolute",left:0,top:0,"z-index":10000,background:"url(about:blank)"}).hover(function(){if(b.playerFadeNow){return}jQuery(this).find("div[show='mouseover']").fadeIn(400)},function(){b.playerFadeNow=true;jQuery(this).find("div[show='mouseover']").fadeOut(400,function(){b.playerFadeNow=false})}).click(function(){if(b.settings.events&&b.settings.events.imageClick){b.settings.events.imageClick(b)}});this.container.css({position:"relative"}).append(this.areaMain,this.areaWidgets)};this.constructAreaStatus=function(){if(this.settings.structure.controls){this.areaStatus=jQuery("<div>").append(jQuery("<div>").addClass(this.settings.structure.controls.containerClass));if(this.settings.structure.controls.align=="center"){this.areaStatus.find("div").css("text-align","center")}else{if(this.settings.status.align=="right"){this.areaStatus.find("div").css("text-align","right")}else{this.areaStatus.find("div").css("text-align","left")}}for(i=0;i<this.settings.content.images.length;i++){var e=(this.settings.structure.controls.previewMode)?jQuery("<img>").attr("src",this.settings.content.images[i]):null;this.areaStatus.children("div").append(jQuery("<div>").addClass(this.settings.structure.controls.elementClass).attr("inarray",i).click(function(){b.stopSliding(parseInt(jQuery(this).attr("inarray")))}).append(e))}this.container.append(this.areaStatus);this.updateStatus()}};this.constructMessage=function(){if(this.settings.structure.messages){var e=(this.settings.animation.showMessages=="random")?Math.floor(Math.random()*this.settings.content.messages.length):0;this.areaMessage=jQuery("<div>").css({position:"absolute",left:this.settings.structure.messages.left?this.settings.structure.messages.left:"auto",top:this.settings.structure.messages.top?this.settings.structure.messages.top:"auto",bottom:this.settings.structure.messages.bottom?this.settings.structure.messages.bottom:"auto",right:this.settings.structure.messages.right?this.settings.structure.messages.right:"auto"}).addClass(this.settings.structure.messages.containerClass).html(this.settings.content.messages[e]).appendTo(this.areaWidgets).click(function(){if(b.settings.events&&b.settings.events.messageClick){b.settings.events.messageClick(b)}})}};this.constructPlayer=function(){if(this.settings.structure.player){var e=jQuery("<div>").css({position:"absolute",left:this.settings.structure.player.left?this.settings.structure.player.left:"auto",right:(this.settings.structure.player.right)?this.settings.structure.player.right:"auto",top:this.settings.structure.player.top?this.settings.structure.player.top:"auto",bottom:this.settings.structure.player.bottom?this.settings.structure.player.bottom:"auto"}).attr("show",this.settings.structure.player.show).addClass(this.settings.structure.player.containerClass);if(this.settings.structure.player.show=="mouseover"){e.hide()}jQuery("<div>").html(this.settings.structure.player.backText).appendTo(e).addClass(this.settings.structure.player.backClass).click(function(){if(b.animationNow){return}if(b.settings.events&&b.settings.events.prev){b.settings.events.prev(b)}b.stopSliding((--b.currentImage<0)?(b.settings.content.images.length-1):b.currentImage)});jQuery("<div>").html(this.settings.structure.player.pauseText).appendTo(e).addClass(this.settings.structure.player.pauseClass).click(function(f){if(b.settings.events&&b.settings.events.stop){b.settings.events.stop(b)}b.stopSliding(false)});jQuery("<div>").html(this.settings.structure.player.playText).appendTo(e).addClass(this.settings.structure.player.playClass).hide().click(function(f){if(b.animationNow){return}if(b.settings.events&&b.settings.events.start){b.settings.events.start(b)}b.startSliding(false)});jQuery("<div>").html(this.settings.structure.player.forwardText).appendTo(e).addClass(this.settings.structure.player.forwardClass).click(function(f){if(b.animationNow){return}if(b.settings.events&&b.settings.events.next){b.settings.events.next(b)}b.stopSliding((++b.currentImage==b.settings.content.images.length)?0:b.currentImage)});this.areaWidgets.append(e);this.areaPlayer=e}};this.startSliding=function(e){this.stopped=false;if(this.areaPlayer&&this.areaPlayer.size()){this.areaPlayer.children("div:eq(1)").show();this.areaPlayer.children("div:eq(2)").hide()}if(e){setTimeout(function(){if(b.settings.animation.waitAllImages&&b.imagesLoaded==b.settings.content.images.length){b.animateAutomatically()}else{b.startSliding(true)}},this.settings.animation.initialInterval?this.settings.animation.initialInterval:this.settings.animation.interval)}else{this.animateAutomatically()}};this.stopSliding=function(e){this.stopped=true;if(this.areaPlayer){this.areaPlayer.children("div:eq(1)").hide();this.areaPlayer.children("div:eq(2)").show()}if(this.animationNow){return}if(e||e===0){this.currentImage=e;this.updateStatus();this.animateCurrent(function(){})}};this.drawCells=function(m,l){this.cells=new Array();this.areaChessboard=jQuery("<div>").css({width:this.settings.structure.container.width,height:this.settings.structure.container.height,position:"absolute",left:0,top:0,"z-index":9000});var g=Math.floor(this.settings.structure.container.width/m),o=Math.floor(this.settings.structure.container.height/l),n=this.settings.structure.container.width%m,p=this.settings.structure.container.height%l,h=0,q=0;for(i=0;i<l;i++){for(j=0;j<m;j++){var e=g+((n>j)?1:0),f=o+((p>i)?1:0);this.areaChessboard.append(jQuery("<div>").css({width:e+"px",height:f+"px","float":"left",margin:0,overflow:"hidden",visibility:"hidden"}).attr({chessboardx:j,chessboardy:i}).append(jQuery("<img>").css({width:this.width,height:this.height,"margin-left":h+"px","margin-top":q+"px"}).attr("src",this.settings.content.images[this.currentImage])));h=(j==m-1)?0:(h-e)}q-=f}this.container.append(this.areaChessboard)};this.removeCells=function(){if(this.areaChessboard){this.areaMain.find("img:first").attr("src",this.settings.content.images[this.currentImage]);this.areaChessboard.remove();this.areaChessboard=false;return true}return false};this.fadeCells=function(g,h){var f=g?g:0,e=this.currentEffect.steps*1;setTimeout(function(){if(f>=b.cells.length){if(f==b.cells.length+e){b.removeCells();h();return}}else{b.cells[f].css("visibility","visible").css("opacity",1/e)}f++;for(i=1;i<e;i++){if(b.cells[f-i]){b.cells[f-i].css("opacity",(i+1)/e)}}b.fadeCells(f,h)},this.currentEffect.duration/(this.currentEffect.size*1+e-1))};this.updateStatus=function(){if(!this.areaStatus){return}setTimeout(function(){b.areaStatus.children("div").children("div").removeClass(b.settings.structure.controls.elementActiveClass).addClass(b.settings.structure.controls.elementClass).eq(b.currentImage).removeClass(b.settings.structure.controls.elementClass).addClass(b.settings.structure.controls.elementActiveClass)},1)};this.nextImage=function(){this.currentImage=(this.currentImage==this.settings.content.images.length-1)?0:(this.currentImage+1);this.updateStatus()};this.startzoom=function(f,e,g){this.areaMain.find("img:first").attr("src",b.settings.content.images[b.currentImage]).css("display","block").animate({width:Math.round((1+this.currentEffect.size/100)*this.settings.structure.container.width)+"px",height:Math.round((1+this.currentEffect.size/100)*this.settings.structure.container.height)+"px",marginLeft:Math.round(-1*f*this.settings.structure.container.width)+"px",marginTop:Math.round(-1*e*this.settings.structure.container.height)+"px"},parseInt(this.currentEffect.duration),function(){jQuery(this).css({width:b.settings.structure.container.width+"px",height:b.settings.structure.container.height+"px","margin-left":0,"margin-top":0});g()})};this.zoomLeftTop=function(e){this.startzoom(0,0,e)};this.zoomRightTop=function(e){this.startzoom(this.currentEffect.size/100,0,e)};this.zoomLeftBottom=function(e){this.startzoom(0,this.currentEffect.size/100,e)};this.zoomRightBottom=function(e){this.startzoom(this.currentEffect.size/100,this.currentEffect.size/100,e)};this.zoomCenter=function(e){this.startzoom(this.currentEffect.size/100/2,this.currentEffect.size/100/2,e)};this.zoomRandom=function(e){this.startzoom(Math.random()*this.currentEffect.size/100,Math.random()*this.currentEffect.size/100,e)};this.slideLeft=function(e){jQuery("<img>").attr("src",this.settings.content.images[this.currentImage]).appendTo(this.areaMain);this.areaMain.find("img:first").animate({marginLeft:"-"+this.settings.structure.container.width+"px"},parseInt(this.currentEffect.duration),function(){jQuery(this).remove();e()})};this.slideRight=function(e){jQuery("<img>").attr("src",this.settings.content.images[this.currentImage]).css("margin-left","-"+this.settings.structure.container.width+"px").insertBefore(this.areaMain.children("img:first"));this.areaMain.find("img:first").animate({marginLeft:"0"},parseInt(this.currentEffect.duration),function(){jQuery(this).next().remove();e()})};this.slideUp=function(e){this.areaMain.css("white-space","normal").append(jQuery("<img>").attr("src",this.settings.content.images[this.currentImage]).css("display","block"));this.areaMain.find("img:first").css("display","block").animate({marginTop:"-"+this.settings.structure.container.height+"px"},parseInt(this.currentEffect.duration),function(){jQuery(this).next().css("display","inline");jQuery(this).remove();e()});this.areaMain.css("white-space","nowrap")};this.slideDown=function(e){this.areaMain.css("white-space","normal").find("img:first").css("display","block");jQuery("<img>").css("display","block").attr("src",this.settings.content.images[this.currentImage]).css("margin-top","-"+this.settings.structure.container.height+"px").insertBefore(this.areaMain.find("img:first"));this.areaMain.find("img:first").animate({marginTop:"0"},parseInt(this.currentEffect.duration),function(){jQuery(this).css("display","inline");jQuery(this).next().remove();e()});this.areaMain.css("white-space","nowrap")};this.fadeOut=function(e){jQuery("<img>").css({position:"absolute"}).attr("src",this.settings.content.images[this.currentImage]).insertBefore(this.areaMain.find("img:first")).fadeOut(0).fadeIn(parseInt(this.currentEffect.duration),function(){jQuery(this).css("position","static");jQuery(this).css("display","inline");jQuery(this).next().remove();e()})};this.chessBoardRightDown=function(g){this.drawCells(this.currentEffect.size,this.currentEffect.size);var f=this.areaChessboard.find("div");for(i=0;i<this.currentEffect.size*2-1;i++){for(j=0;j<this.currentEffect.size;j++){for(k=0;k<this.currentEffect.size;k++){if(j+k==i){var e=f.filter("div[chessboardx='"+j+"'][chessboardy='"+k+"']");this.cells[i]=this.cells[i]?this.cells[i].add(e):e}}}}this.fadeCells(false,g)};this.chessBoardLeftDown=function(g){this.drawCells(this.currentEffect.size,this.currentEffect.size);var f=this.areaChessboard.find("div");for(i=0;i<this.currentEffect.size*2-1;i++){for(j=0;j<this.currentEffect.size;j++){for(k=0;k<this.currentEffect.size;k++){if((this.currentEffect.size-j-1)+k==i){var e=f.filter("div[chessboardx='"+j+"'][chessboardy='"+k+"']");this.cells[i]=this.cells[i]?this.cells[i].add(e):e}}}}this.fadeCells(false,g)};this.chessBoardLeftUp=function(g){this.drawCells(this.currentEffect.size,this.currentEffect.size);var f=this.areaChessboard.find("div");for(i=0;i<this.currentEffect.size*2-1;i++){for(j=0;j<this.currentEffect.size;j++){for(k=0;k<this.currentEffect.size;k++){if(this.currentEffect.size*2-j-k-2==i){var e=f.filter("div[chessboardx='"+j+"'][chessboardy='"+k+"']");this.cells[i]=this.cells[i]?this.cells[i].add(e):e}}}}this.fadeCells(false,g)};this.chessBoardRightUp=function(g){this.drawCells(this.currentEffect.size,this.currentEffect.size);var f=this.areaChessboard.find("div");for(i=0;i<this.currentEffect.size*2-1;i++){for(j=0;j<this.currentEffect.size;j++){for(k=0;k<this.currentEffect.size;k++){if(j+(this.currentEffect.size-k-1)==i){var e=f.filter("div[chessboardx='"+j+"'][chessboardy='"+k+"']");this.cells[i]=this.cells[i]?this.cells[i].add(e):e}}}}this.fadeCells(false,g)};this.chessBoardRandom=function(o){this.drawCells(this.currentEffect.size,this.currentEffect.size);var l=this.areaChessboard.find("div"),n=new Array(),g=this.currentEffect.size*this.currentEffect.size;for(i=0;i<this.currentEffect.size;i++){for(j=0;j<this.currentEffect.size;j++){n[i*this.currentEffect.size+j]=i+","+j}}for(i=0;i<this.currentEffect.size;i++){for(j=0;j<this.currentEffect.size;j++){var m=Math.floor(Math.random()*g)%n.length,f=0,h;while(m!=-1){if(n[f]){m--;h=f}f=(f==n.length-1)?0:(f+1)}var e=n[h].split(",");n[h]=false;var f=l.filter("div[chessboardx='"+e[0]+"'][chessboardy='"+e[1]+"']");this.cells[i]=this.cells[i]?this.cells[i].add(f):f}}this.fadeCells(false,o)};this.jalousieRight=function(g){this.drawCells(this.currentEffect.size,1);var f=this.areaChessboard.find("div");for(i=0;i<this.currentEffect.size;i++){var e=f.filter("div[chessboardx='"+i+"']");this.cells[i]=e}this.fadeCells(false,g)};this.jalousieDown=function(g){this.drawCells(1,this.currentEffect.size);var f=this.areaChessboard.find("div");for(i=0;i<this.currentEffect.size;i++){var e=f.filter("div[chessboardy='"+i+"']");this.cells[i]=e}this.fadeCells(false,g)};this.jalousieLeft=function(g){this.drawCells(this.currentEffect.size,1);var f=this.areaChessboard.find("div");for(i=0;i<this.currentEffect.size;i++){var e=f.filter("div[chessboardx='"+(this.currentEffect.size-i-1)+"']");this.cells[i]=e}this.fadeCells(false,g)};this.jalousieUp=function(g){this.drawCells(1,this.currentEffect.size);var f=this.areaChessboard.find("div");for(i=0;i<this.currentEffect.size;i++){var e=f.filter("div[chessboardy='"+(this.currentEffect.size-i-1)+"']");this.cells[i]=e}this.fadeCells(false,g)};this.jalousieRandomHorizontal=function(m){this.drawCells(this.currentEffect.size,1);var g=this.areaChessboard.find("div"),l=new Array();for(i=0;i<this.currentEffect.size;i++){l[i]=i+",1"}for(i=0;i<this.currentEffect.size;i++){var h=Math.floor(Math.random()*this.currentEffect.size)%l.length,e=0,f;while(h!=-1){if(l[e]){h--;f=e}e=(e==l.length-1)?0:(e+1)}var e=g.filter("div[chessboardx='"+l[f].split(",")[0]+"']");l[f]=false;this.cells[i]=this.cells[i]?this.cells[i].add(e):e}this.fadeCells(false,m)};this.jalousieRandomVertical=function(m){this.drawCells(1,this.currentEffect.size);var g=this.areaChessboard.find("div"),l=new Array();for(i=0;i<this.currentEffect.size;i++){l[i]=i+",1"}for(i=0;i<this.currentEffect.size;i++){var h=Math.floor(Math.random()*this.currentEffect.size)%l.length,e=0,f;while(h!=-1){if(l[e]){h--;f=e}e=(e==l.length-1)?0:(e+1)}var e=g.filter("div[chessboardy='"+l[f].split(",")[0]+"']");l[f]=false;this.cells[i]=this.cells[i]?this.cells[i].add(e):e}this.fadeCells(false,m)};this.pancakeIn=function(h){this.drawCells(this.currentEffect.size,this.currentEffect.size);var g=this.areaChessboard.find("div");for(border=0;border<Math.ceil(this.currentEffect.size/2);border++){var e=this.currentEffect.size-1-border;for(i=0;i<this.currentEffect.size;i++){for(j=0;j<this.currentEffect.size;j++){if(i>=border&&j>=border&&i<=e&&j<=e&&(i==border||i==e||j==border||j==e)){var f=g.filter("div[chessboardx='"+i+"'][chessboardy='"+j+"']");this.cells[border]=this.cells[border]?this.cells[border].add(f):f}}}}this.fadeCells(false,h)};this.pancakeOut=function(l){this.drawCells(this.currentEffect.size,this.currentEffect.size);var h=this.areaChessboard.find("div");for(border=Math.ceil(this.currentEffect.size/2)-1;border>=0;border--){var f=Math.ceil(this.currentEffect.size/2)-1-border,e=this.currentEffect.size-1-f;for(i=0;i<this.currentEffect.size;i++){for(j=0;j<this.currentEffect.size;j++){if(i>=f&&j>=f&&i<=e&&j<=e&&(i==f||i==e||j==f||j==e)){var g=h.filter("div[chessboardx='"+i+"'][chessboardy='"+j+"']");this.cells[border]=this.cells[border]?this.cells[border].add(g):g}}}}this.fadeCells(false,l)};this.pancakeRandom=function(o){this.drawCells(this.currentEffect.size,this.currentEffect.size);var l=this.areaChessboard.find("div"),n=new Array();for(i=0;i<Math.ceil(this.currentEffect.size/2);i++){n[i]=i+",1"}for(border=Math.ceil(this.currentEffect.size/2)-1;border>=0;border--){var m=Math.floor(Math.random()*Math.ceil(this.currentEffect.size/2))%n.length,g=0,h;while(m!=-1){if(n[g]){m--;h=g}g=(g==n.length-1)?0:(g+1)}var f=n[h].split(",")[0],e=this.currentEffect.size-1-f;for(i=0;i<this.currentEffect.size;i++){for(j=0;j<this.currentEffect.size;j++){if(i>=f&&j>=f&&i<=e&&j<=e&&(i==f||i==e||j==f||j==e)){var g=l.filter("div[chessboardx='"+i+"'][chessboardy='"+j+"']");this.cells[border]=this.cells[border]?this.cells[border].add(g):g}}}n[h]=false}this.fadeCells(false,o)};this.spiralIn=function(l){this.drawCells(this.currentEffect.size,this.currentEffect.size);var h=this.areaChessboard.find("div");var g=-1;for(border=0;border<Math.ceil(this.currentEffect.size/2);border++){var e=this.currentEffect.size-border-1;for(i=border;i<=e;i++){g++;var f=h.filter("div[chessboardx='"+i+"'][chessboardy='"+border+"']");this.cells[g]=this.cells[g]?this.cells[g].add(f):f}for(i=border+1;i<=e;i++){g++;var f=h.filter("div[chessboardx='"+e+"'][chessboardy='"+i+"']");this.cells[g]=this.cells[g]?this.cells[g].add(f):f}for(i=e-1;i>=border;i--){g++;var f=h.filter("div[chessboardx='"+i+"'][chessboardy='"+e+"']");this.cells[g]=this.cells[g]?this.cells[g].add(f):f}for(i=e-1;i>=border+1;i--){g++;var f=h.filter("div[chessboardx='"+border+"'][chessboardy='"+i+"']");this.cells[g]=this.cells[g]?this.cells[g].add(f):f}}this.fadeCells(false,l)};this.spiralOut=function(l){this.drawCells(this.currentEffect.size,this.currentEffect.size);var h=this.areaChessboard.find("div");var g=-1;for(border=Math.ceil(this.currentEffect.size/2)-1;border>=0;border--){var e=this.currentEffect.size-border-1;for(i=border+1;i<=e;i++){g++;var f=h.filter("div[chessboardx='"+e+"'][chessboardy='"+i+"']");this.cells[g]=this.cells[g]?this.cells[g].add(f):f}for(i=e-1;i>=border;i--){g++;var f=h.filter("div[chessboardx='"+i+"'][chessboardy='"+e+"']");this.cells[g]=this.cells[g]?this.cells[g].add(f):f}for(i=e-1;i>=border+1;i--){g++;var f=h.filter("div[chessboardx='"+border+"'][chessboardy='"+i+"']");this.cells[g]=this.cells[g]?this.cells[g].add(f):f}for(i=border;i<=e;i++){g++;var f=h.filter("div[chessboardx='"+i+"'][chessboardy='"+border+"']");this.cells[g]=this.cells[g]?this.cells[g].add(f):f}}this.fadeCells(false,l)};this.prisonVertical=function(h){this.drawCells(this.currentEffect.size,1);var g=this.areaChessboard.find("div");for(i=0;i<this.currentEffect.size;i++){var e=g.filter("div[chessboardx='"+i+"']"),f;e.css({overflow:"hidden",visibility:"visible",opacity:1}).find("img:first").css("margin-top",((i%2==0)?"-":"")+this.settings.structure.container.height+"px").animate({marginTop:0},parseInt(this.currentEffect.duration),function(){if(b.removeCells()){h()}})}};this.prisonHorizontal=function(h){this.drawCells(1,this.currentEffect.size);var g=this.areaChessboard.find("div");for(i=0;i<this.currentEffect.size;i++){var e=g.filter("div[chessboardy='"+i+"']"),f;e.css({overflow:"hidden",visibility:"visible",opacity:1}).find("img:first").css("margin-left",((i%2==0)?"-":"")+this.settings.structure.container.width+"px").animate({marginLeft:0},parseInt(this.currentEffect.duration),function(){if(b.removeCells()){h()}})}};this.animateAutomatically=function(){if(this.stopped){return}this.nextImage();this.animateCurrent(function(){setTimeout(function(){b.animateAutomatically()},b.settings.animation.interval)})};this.animateCurrent=function(e){if(this.animationNow){return}if(b.settings.events&&this.settings.events.beforeSlide){this.settings.events.beforeSlide(b)}this.currentEffect=this.userEffects[Math.floor(Math.random()*this.userEffects.length)];this.run=this.currentEffect.run;this.animationNow=true;if(b.settings.events&&this.settings.events.afterSlideStart){this.settings.events.afterSlideStart(b)}this.run(function(){b.animationNow=false;if(b.settings.events&&b.settings.events.beforeSlideEnd){b.settings.events.beforeSlideEnd(b)}if(e){e()}if(b.settings.events&&b.settings.events.afterSlide){b.settings.events.afterSlide(b)}});if(b.settings.events&&this.settings.events.beforeMessageChange){this.settings.events.beforeMessageChange(b)}if(this.settings.content.messages){if(d.animation.showMessages=="random"){this.currentMessage=Math.floor(Math.random()*this.settings.content.messages.length);this.messagesAnimationCounter=1}else{if(d.animation.showMessages=="linked"){this.currentMessage=this.currentImage;this.messagesAnimationCounter=1}else{if(!this.messagesAnimationCounter||this.messagesAnimationCounter==1){this.messagesAnimationCounter=this.settings.animation.changeMessagesAfter;this.currentMessage=(++this.currentMessage==this.settings.content.messages.length)?0:this.currentMessage}else{this.messagesAnimationCounter--}}}}if(this.messagesAnimationCounter==1){this.areaMessage.html(this.settings.content.messages[this.currentMessage])}if(b.settings.events&&this.settings.events.afterMessageChange){this.settings.events.afterMessageChange(b)}};if(b.settings.events&&this.settings.events.beforeInitialize){this.settings.events.beforeInitialize(b)}this.initialize();if(b.settings.events&&this.settings.events.afterInitialize){this.settings.events.afterInitialize(b)}};